<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Kurulumu - TonBot</title>
    
    <link rel="stylesheet" href="Style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- STÄ°LLER --- */
        body { background-color: #f5f5f7; padding-top: 90px; min-height: 100vh; display: flex; flex-direction: column; align-items: center; font-family: 'Inter', sans-serif; }
        .setup-header { position: fixed; top: 0; left: 0; width: 100%; height: 70px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: space-between; padding: 0 5%; border-bottom: 1px solid rgba(0,0,0,0.05); z-index: 1000; }
        .brand-logo { font-size: 1.5rem; font-weight: 800; color: #1D1D1F; text-decoration: none; display: flex; align-items: center; gap: 8px; }
        .logo-dot { width: 10px; height: 10px; background-color: #25D366; border-radius: 50%; }
        .btn-logout { background: transparent; border: 1px solid #ddd; color: #666; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: 0.2s; }
        .btn-logout:hover { border-color: #d32f2f; color: #d32f2f; background: #fff5f5; }

        .wizard-container { width: 90%; max-width: 650px; background: white; border-radius: 24px; padding: 50px 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.06); border: 1px solid rgba(0,0,0,0.02); animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        /* Progress Bar */
        .progress-bar { display: flex; justify-content: space-between; margin-bottom: 40px; position: relative; }
        .progress-line { position: absolute; top: 15px; left: 0; width: 100%; height: 2px; background: #f0f0f0; z-index: 0; }
        .step { position: relative; z-index: 1; text-align: center; flex: 1; }
        
        .step-circle { width: 32px; height: 32px; background: #f0f0f0; border-radius: 50%; margin: 0 auto 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; color: #999; font-size: 0.9rem; transition: 0.3s; border: 2px solid #fff; }
        .step-text { font-size: 0.75rem; color: #999; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .active .step-circle { background: #007aff; color: white; box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.15); }
        .active .step-text { color: #007aff; }
        .completed .step-circle { background: #25D366; color: white; }
        .completed .step-text { color: #25D366; }

        /* Ä°Ã§erik */
        .step-content { display: none; }
        .step-content.current { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h2 { font-size: 1.8rem; margin-bottom: 10px; color: #1d1d1f; text-align: center; font-weight: 800; }
        p { color: #86868b; text-align: center; margin-bottom: 30px; font-size: 1rem; }

        /* Form ElemanlarÄ± */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; color: #333; }
        .form-input, .form-select, .form-textarea {
            width: 100%; padding: 14px; border: 1px solid #d1d1d6; border-radius: 12px;
            font-size: 1rem; outline: none; font-family: 'Inter', sans-serif; box-sizing: border-box;
            background-color: #fbfbfd; transition: all 0.2s;
        }
        .form-textarea { height: 180px; resize: vertical; }

        /* Butonlar */
        .btn-next {
            width: 100%; padding: 16px; background: #007aff; color: white; border: none;
            border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: 0.2s;
            margin-top: 20px; box-shadow: 0 4px 12px rgba(0,122,255,0.2);
        }
        .btn-next:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,122,255,0.3); }

    </style>
</head>
<body>

    <script>
        const userCheck = localStorage.getItem('tonbot_user');
        if (!userCheck) {
            window.location.href = 'login.html'; 
        }
    </script>

    <header class="setup-header">
        <a href="index.html" class="brand-logo">
            <span class="logo-dot"></span> TonBot
        </a>
        <button onclick="cikisYap()" class="btn-logout">Ã‡Ä±kÄ±ÅŸ Yap</button>
    </header>

    <div class="wizard-container">
        
        <div class="progress-bar">
            <div class="progress-line"></div>
            <div class="step active" id="step-indicator-1">
                <div class="step-circle">1</div>
                <div class="step-text">Kimlik</div>
            </div>
            <div class="step" id="step-indicator-2">
                <div class="step-circle">2</div>
                <div class="step-text">EÄŸitim</div>
            </div>
            <div class="step" id="step-indicator-3">
                <div class="step-circle">3</div>
                <div class="step-text">Ã–deme</div>
            </div>
        </div>

        <div id="step-1" class="step-content current">
            <h2>Ä°ÅŸletme KimliÄŸi</h2>
            <p>Botunuzun adÄ±nÄ± ve konuÅŸma tarzÄ±nÄ± belirleyin.</p>

            <div class="form-group">
                <label>Ä°ÅŸletme AdÄ±nÄ±z (Benzersiz Kimlik)</label>
                <input type="text" id="session-id" class="form-input" placeholder="Ã–rn: butik_ayse" required>
            </div>
            
            <div class="form-group">
                <label>Botun AdÄ±</label>
                <input type="text" id="bot-name" class="form-input" placeholder="Ã–rn: AslÄ±, Destek Ekibi" required>
            </div>

            <div class="form-group">
                <label>KonuÅŸma TarzÄ±</label>
                <select id="bot-tone" class="form-select form-input">
                    <option value="Samimi ve bol emojili">ðŸ˜Š Samimi ve Emojili</option>
                    <option value="Kurumsal ve resmi">ðŸ‘” Kurumsal ve Resmi</option>
                    <option value="LÃ¼ks ve seÃ§kin">ðŸ’Ž LÃ¼ks ve SeÃ§kin</option>
                </select>
            </div>

            <button onclick="adimGec(2)" class="btn-next">Devam Et â†’</button>
        </div>

        <div id="step-2" class="step-content">
            <h2>Bilgi BankasÄ± ðŸ“š</h2>
            <p>ÃœrÃ¼nlerini, fiyatlarÄ±nÄ± ve linklerini buraya yapÄ±ÅŸtÄ±r. Bot buradan Ã¶ÄŸrenip cevap verecek.</p>

            <div class="form-group">
                <label>EÄŸitim Metni ve Linkler</label>
                <textarea id="knowledge-base" class="form-textarea" placeholder="- Sen Yapay Zeka Ä°ÅŸletmemiz Ä°Ã§in AjansÄ±n 
-ÃœrÃ¼n linkleri bunlardÄ±r sadece mÃ¼ÅŸteri sorarsa link ver Ã¼rÃ¼n sorulursa Ã¼rÃ¼nÃ¼n linkini ve fiyatÄ±nÄ± at 
link.com 500 TL
link2.com 600 TL
link3.com 700 TL
link4.com 800 TL
.
.

- Kargo: 1000 TL Ã¼zeri bedava.
- Adres: KadÄ±kÃ¶y BoÄŸa heykeli yanÄ±."></textarea>
            </div>

            <button onclick="veriyiGeciciKaydetVeOdeyeGec()" class="btn-next" style="background: #25D366; box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);">Ã–demeye GeÃ§ â†’</button>
        </div>

        <div id="step-3" class="step-content">
            <h2>Ã–deme Bekleniyor...</h2>
            <p>Ã–deme baÅŸarÄ±lÄ± olduktan sonra, kurulumunuz otomatik tamamlanacak ve QR kodunuz gÃ¶rÃ¼necektir.</p>
            <div style="text-align:center; padding: 20px;">
                <p>LÃ¼tfen Ã¶deme sayfasÄ±nÄ± tamamlayÄ±n veya aÅŸaÄŸÄ±daki butona tÄ±klayÄ±n.</p>
                <a href="login.html" class="btn-next" style="display:inline-block; width:auto; padding: 15px 40px; background:#007aff; text-decoration:none;">Ã–deme SayfasÄ±na Git</a>
            </div>
        </div>

    </div>

    <script>
        // KÃ¼tÃ¼phane yÃ¼klemeleri (Socket/QR) bu sayfadan kaldÄ±rÄ±ldÄ±
        let currentUserId = null;
        let currentSessionId = "";


        // 1. GÃœVENLÄ°K KONTROLÃœ
        const userStr = localStorage.getItem('tonbot_user');
        if (!userStr) {
            window.location.href = 'login.html'; 
        } else {
            const userObj = JSON.parse(userStr);
            currentUserId = userObj.id; // Supabase User ID
        }

        // --- ADIM GEÃ‡Ä°ÅžLERÄ° ---
        function adimGec(adimNo) {
            document.querySelectorAll('.step-content').forEach(el => el.classList.remove('current'));
            document.getElementById(`step-${adimNo}`).classList.add('current');

            document.querySelectorAll('.step').forEach((el, index) => {
                if (index + 1 < adimNo) el.classList.add('completed');
                if (index + 1 === adimNo) el.classList.add('active');
            });
        }
        
        function cikisYap() {
            localStorage.removeItem('tonbot_user');
            window.location.href = 'login.html';
        }


        // --- VERÄ° TOPLAMA VE Ã–DEMEYE YÃ–NLENDÄ°RME (STEP 2'NÄ°N SONU) ---
        function veriyiGeciciKaydetVeOde() {
            const sessionIdInput = document.getElementById('session-id').value.trim();
            const botName = document.getElementById('bot-name').value;
            const botTone = document.getElementById('bot-tone').value;
            const knowledge = document.getElementById('knowledge-base').value;

            // Alan KontrolÃ¼
            if (!sessionIdInput.trim() || !botName.trim()) {
                return alert("LÃ¼tfen Ä°ÅŸletme AdÄ± ve Bot AdÄ±nÄ± doldurun!");
            }
            
            // 1. Veri Paketini HazÄ±rla
            const configData = {
                session_id: sessionIdInput.toLowerCase().replace(/ /g, '_'),
                user_id: currentUserId,
                bot_name: botName,
                bot_tone: botTone,
                knowledge: knowledge
            };
            
            // 2. GeÃ§ici HafÄ±zaya Kaydet (Setup2'de Ã§ekilecek)
            sessionStorage.setItem('bot_config_pending', JSON.stringify(configData));
            
            // 3. Ã–deme SayfasÄ±na YÃ¶nlendir
            // (Pricing'den gelen plan bilgisini de taÅŸÄ±yabilirsin)
            const urlParams = new URLSearchParams(window.location.search);
            const plan = urlParams.get('plan') || 'pro'; 

            // Ã–NEMLÄ°: Bu, LemonSqueezy/Stripe gibi bir platforma yÃ¶nlendirecek
            // BaÅŸarÄ±lÄ± Ã¶demeden sonra bu platform seni setup2.html'e geri atmalÄ±.
            alert("Bilgileriniz kaydedildi. Ã–deme sayfasÄ±na yÃ¶nlendiriliyor...");

            // Åžu an elimizde gerÃ§ek Ã¶deme linki olmadÄ±ÄŸÄ± iÃ§in setup2'ye yÃ¶nlendiriyoruz.
            window.location.href = `setup2.html?plan=${plan}&session_id=${configData.session_id}`;
        }


        // Sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda varsayÄ±lan olarak AdÄ±m 1'i gÃ¶ster
        window.addEventListener('DOMContentLoaded', () => {
             // EÄŸer URL'de session ID varsa (yani Ã¶deme sonrasÄ± dÃ¶nÃ¼ldÃ¼yse)
             const urlParams = new URLSearchParams(window.location.search);
             if (urlParams.get('session_id') && urlParams.get('status') === 'paid') {
                 // EÄŸer bu senaryo gerÃ§ekleÅŸirse, kullanÄ±cÄ±yÄ± direkt Setup2'ye atardÄ±k
                 // Ama ÅŸu anki flow'da setup.html sadece veri topladÄ±ÄŸÄ± iÃ§in, bu kontrolÃ¼ basit tutuyoruz.
             }

             // Ä°lk adÄ±mÄ± gÃ¶ster
             adimGec(1);
        });

    </script>

</body>
</html>
